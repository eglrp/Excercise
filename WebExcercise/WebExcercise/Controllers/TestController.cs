using System;
using System.Collections.Generic;
using System.Linq;
using System.Net;
using System.Net.Http;
using System.Web.Http;
using System.Web;
using System.IO;

namespace WebExcercise.Controllers
{
    public class TestController : ApiController
    {
        [HttpGet]
        public HttpContext ExportExcel()
        {
            string tableHtml="<thead><tr><th colspan=\"2\" rowspan=\"1\"></th><th class=\"pvtAxisLabel\">年</th><th class=\"pvtColLabel\" colspan=\"1\" rowspan=\"2\">1</th><th class=\"pvtColLabel\" colspan=\"1\" rowspan=\"2\">2007</th><th class=\"pvtColLabel\" colspan=\"1\" rowspan=\"2\">2011</th><th class=\"pvtColLabel\" colspan=\"1\" rowspan=\"2\">2012</th><th class=\"pvtColLabel\" colspan=\"1\" rowspan=\"2\">2013</th><th class=\"pvtColLabel\" colspan=\"1\" rowspan=\"2\">2014</th><th class=\"pvtColLabel\" colspan=\"1\" rowspan=\"2\">2015</th><th class=\"pvtColLabel\" colspan=\"1\" rowspan=\"2\">2016</th><th class=\"pvtColLabel\" colspan=\"1\" rowspan=\"2\">2017</th><th class=\"pvtTotalLabel\" rowspan=\"2\">Totals</th></tr><tr><th class=\"pvtAxisLabel\">域名分组</th><th class=\"pvtAxisLabel\">命中关键词数</th><th></th></tr></thead><tbody><tr><th class=\"pvtRowLabel\" rowspan=\"1\">博客</th><th class=\"pvtRowLabel\" rowspan=\"1\" colspan=\"2\">1</th><td class=\"pvtVal row0 col0\" data-value=\"null\"></td><td class=\"pvtVal row0 col1\" data-value=\"null\"></td><td class=\"pvtVal row0 col2\" data-value=\"1\" style=\"background-color: rgb(255, 255, 255);\">1</td><td class=\"pvtVal row0 col3\" data-value=\"1\" style=\"background-color: rgb(255, 255, 255);\">1</td><td class=\"pvtVal row0 col4\" data-value=\"null\"></td><td class=\"pvtVal row0 col5\" data-value=\"null\"></td><td class=\"pvtVal row0 col6\" data-value=\"null\"></td><td class=\"pvtVal row0 col7\" data-value=\"1\" style=\"background-color: rgb(255, 255, 255);\">1</td><td class=\"pvtVal row0 col8\" data-value=\"null\"></td><td class=\"pvtTotal rowTotal\" data-value=\"3\" data-for=\"row0\" style=\"background-color: rgb(255, 252, 252);\">3</td></tr><tr><th class=\"pvtRowLabel\" rowspan=\"1\">教育</th><th class=\"pvtRowLabel\" rowspan=\"1\" colspan=\"2\">1</th><td class=\"pvtVal row1 col0\" data-value=\"null\"></td><td class=\"pvtVal row1 col1\" data-value=\"null\"></td><td class=\"pvtVal row1 col2\" data-value=\"null\"></td><td class=\"pvtVal row1 col3\" data-value=\"null\"></td><td class=\"pvtVal row1 col4\" data-value=\"null\"></td><td class=\"pvtVal row1 col5\" data-value=\"null\"></td><td class=\"pvtVal row1 col6\" data-value=\"null\"></td><td class=\"pvtVal row1 col7\" data-value=\"1\" style=\"background-color: rgb(255, 255, 255);\">1</td><td class=\"pvtVal row1 col8\" data-value=\"null\"></td><td class=\"pvtTotal rowTotal\" data-value=\"1\" data-for=\"row1\" style=\"background-color: rgb(255, 255, 255);\">1</td></tr><tr><th class=\"pvtRowLabel\" rowspan=\"1\">文库</th><th class=\"pvtRowLabel\" rowspan=\"1\" colspan=\"2\">1</th><td class=\"pvtVal row2 col0\" data-value=\"null\"></td><td class=\"pvtVal row2 col1\" data-value=\"null\"></td><td class=\"pvtVal row2 col2\" data-value=\"null\"></td><td class=\"pvtVal row2 col3\" data-value=\"null\"></td><td class=\"pvtVal row2 col4\" data-value=\"null\"></td><td class=\"pvtVal row2 col5\" data-value=\"null\"></td><td class=\"pvtVal row2 col6\" data-value=\"null\"></td><td class=\"pvtVal row2 col7\" data-value=\"null\"></td><td class=\"pvtVal row2 col8\" data-value=\"1\" style=\"background-color: rgb(255, 255, 255);\">1</td><td class=\"pvtTotal rowTotal\" data-value=\"1\" data-for=\"row2\" style=\"background-color: rgb(255, 255, 255);\">1</td></tr><tr><th class=\"pvtRowLabel\" rowspan=\"1\">新闻</th><th class=\"pvtRowLabel\" rowspan=\"1\" colspan=\"2\">1</th><td class=\"pvtVal row3 col0\" data-value=\"2\" style=\"background-color: rgb(255, 251, 251);\">2</td><td class=\"pvtVal row3 col1\" data-value=\"null\"></td><td class=\"pvtVal row3 col2\" data-value=\"null\"></td><td class=\"pvtVal row3 col3\" data-value=\"null\"></td><td class=\"pvtVal row3 col4\" data-value=\"null\"></td><td class=\"pvtVal row3 col5\" data-value=\"null\"></td><td class=\"pvtVal row3 col6\" data-value=\"null\"></td><td class=\"pvtVal row3 col7\" data-value=\"1\" style=\"background-color: rgb(255, 255, 255);\">1</td><td class=\"pvtVal row3 col8\" data-value=\"null\"></td><td class=\"pvtTotal rowTotal\" data-value=\"3\" data-for=\"row3\" style=\"background-color: rgb(255, 252, 252);\">3</td></tr><tr><th class=\"pvtRowLabel\" rowspan=\"10\">未分组</th><th class=\"pvtRowLabel\" rowspan=\"1\" colspan=\"2\">1</th><td class=\"pvtVal row4 col0\" data-value=\"58\" style=\"background-color: rgb(255, 13, 13);\">58</td><td class=\"pvtVal row4 col1\" data-value=\"3\" style=\"background-color: rgb(255, 246, 246);\">3</td><td class=\"pvtVal row4 col2\" data-value=\"1\" style=\"background-color: rgb(255, 255, 255);\">1</td><td class=\"pvtVal row4 col3\" data-value=\"6\" style=\"background-color: rgb(255, 234, 234);\">6</td><td class=\"pvtVal row4 col4\" data-value=\"7\" style=\"background-color: rgb(255, 229, 229);\">7</td><td class=\"pvtVal row4 col5\" data-value=\"4\" style=\"background-color: rgb(255, 242, 242);\">4</td><td class=\"pvtVal row4 col6\" data-value=\"11\" style=\"background-color: rgb(255, 212, 212);\">11</td><td class=\"pvtVal row4 col7\" data-value=\"61\" style=\"background-color: rgb(255, 0, 0);\">61</td><td class=\"pvtVal row4 col8\" data-value=\"21\" style=\"background-color: rgb(255, 170, 170);\">21</td><td class=\"pvtTotal rowTotal\" data-value=\"172\" data-for=\"row4\" style=\"background-color: rgb(255, 0, 0);\">172</td></tr><tr><th class=\"pvtRowLabel\" rowspan=\"1\" colspan=\"2\">2</th><td class=\"pvtVal row5 col0\" data-value=\"4\" style=\"backgr…owspan=\"1\" colspan=\"2\">1</th><td class=\"pvtVal row21 col0\" data-value=\"2\" style=\"background-color: rgb(255, 251, 251);\">2</td><td class=\"pvtVal row21 col1\" data-value=\"null\"></td><td class=\"pvtVal row21 col2\" data-value=\"1\" style=\"background-color: rgb(255, 255, 255);\">1</td><td class=\"pvtVal row21 col3\" data-value=\"null\"></td><td class=\"pvtVal row21 col4\" data-value=\"null\"></td><td class=\"pvtVal row21 col5\" data-value=\"1\" style=\"background-color: rgb(255, 255, 255);\">1</td><td class=\"pvtVal row21 col6\" data-value=\"null\"></td><td class=\"pvtVal row21 col7\" data-value=\"null\"></td><td class=\"pvtVal row21 col8\" data-value=\"null\"></td><td class=\"pvtTotal rowTotal\" data-value=\"4\" data-for=\"row21\" style=\"background-color: rgb(255, 251, 251);\">4</td></tr><tr><th class=\"pvtRowLabel\" rowspan=\"3\">视频</th><th class=\"pvtRowLabel\" rowspan=\"1\" colspan=\"2\">1</th><td class=\"pvtVal row22 col0\" data-value=\"20\" style=\"background-color: rgb(255, 174, 174);\">20</td><td class=\"pvtVal row22 col1\" data-value=\"null\"></td><td class=\"pvtVal row22 col2\" data-value=\"null\"></td><td class=\"pvtVal row22 col3\" data-value=\"2\" style=\"background-color: rgb(255, 251, 251);\">2</td><td class=\"pvtVal row22 col4\" data-value=\"null\"></td><td class=\"pvtVal row22 col5\" data-value=\"null\"></td><td class=\"pvtVal row22 col6\" data-value=\"1\" style=\"background-color: rgb(255, 255, 255);\">1</td><td class=\"pvtVal row22 col7\" data-value=\"4\" style=\"background-color: rgb(255, 242, 242);\">4</td><td class=\"pvtVal row22 col8\" data-value=\"5\" style=\"background-color: rgb(255, 238, 238);\">5</td><td class=\"pvtTotal rowTotal\" data-value=\"32\" data-for=\"row22\" style=\"background-color: rgb(255, 209, 209);\">32</td></tr><tr><th class=\"pvtRowLabel\" rowspan=\"1\" colspan=\"2\">2</th><td class=\"pvtVal row23 col0\" data-value=\"2\" style=\"background-color: rgb(255, 251, 251);\">2</td><td class=\"pvtVal row23 col1\" data-value=\"null\"></td><td class=\"pvtVal row23 col2\" data-value=\"null\"></td><td class=\"pvtVal row23 col3\" data-value=\"null\"></td><td class=\"pvtVal row23 col4\" data-value=\"null\"></td><td class=\"pvtVal row23 col5\" data-value=\"null\"></td><td class=\"pvtVal row23 col6\" data-value=\"null\"></td><td class=\"pvtVal row23 col7\" data-value=\"2\" style=\"background-color: rgb(255, 251, 251);\">2</td><td class=\"pvtVal row23 col8\" data-value=\"null\"></td><td class=\"pvtTotal rowTotal\" data-value=\"4\" data-for=\"row23\" style=\"background-color: rgb(255, 251, 251);\">4</td></tr><tr><th class=\"pvtRowLabel\" rowspan=\"1\" colspan=\"2\">7</th><td class=\"pvtVal row24 col0\" data-value=\"1\" style=\"background-color: rgb(255, 255, 255);\">1</td><td class=\"pvtVal row24 col1\" data-value=\"null\"></td><td class=\"pvtVal row24 col2\" data-value=\"null\"></td><td class=\"pvtVal row24 col3\" data-value=\"null\"></td><td class=\"pvtVal row24 col4\" data-value=\"null\"></td><td class=\"pvtVal row24 col5\" data-value=\"null\"></td><td class=\"pvtVal row24 col6\" data-value=\"null\"></td><td class=\"pvtVal row24 col7\" data-value=\"null\"></td><td class=\"pvtVal row24 col8\" data-value=\"null\"></td><td class=\"pvtTotal rowTotal\" data-value=\"1\" data-for=\"row24\" style=\"background-color: rgb(255, 255, 255);\">1</td></tr><tr><th class=\"pvtRowLabel\" rowspan=\"1\">财经</th><th class=\"pvtRowLabel\" rowspan=\"1\" colspan=\"2\">1</th><td class=\"pvtVal row25 col0\" data-value=\"null\"></td><td class=\"pvtVal row25 col1\" data-value=\"null\"></td><td class=\"pvtVal row25 col2\" data-value=\"null\"></td><td class=\"pvtVal row25 col3\" data-value=\"null\"></td><td class=\"pvtVal row25 col4\" data-value=\"null\"></td><td class=\"pvtVal row25 col5\" data-value=\"null\"></td><td class=\"pvtVal row25 col6\" data-value=\"null\"></td><td class=\"pvtVal row25 col7\" data-value=\"1\" style=\"background-color: rgb(255, 255, 255);\">1</td><td class=\"pvtVal row25 col8\" data-value=\"null\"></td><td class=\"pvtTotal rowTotal\" data-value=\"1\" data-for=\"row25\" style=\"background-color: rgb(255, 255, 255);\">1</td></tr><tr><th class=\"pvtTotalLabel\" colspan=\"3\">Totals</th><td class=\"pvtTotal colTotal\" data-value=\"123\" data-for=\"col0\" style=\"background-color: rgb(255, 0, 0);\">123</td><td class=\"pvtTotal colTotal\" data-value=\"3\" data-for=\"col1\" style=\"background-color: rgb(255, 255, 255);\">3</td><td class=\"pvtTotal colTotal\" data-value=\"3\" data-for=\"col2\" style=\"background-color: rgb(255, 255, 255);\">3</td><td class=\"pvtTotal colTotal\" data-value=\"10\" data-for=\"col3\" style=\"background-color: rgb(255, 240, 240);\">10</td><td class=\"pvtTotal colTotal\" data-value=\"8\" data-for=\"col4\" style=\"background-color: rgb(255, 244, 244);\">8</td><td class=\"pvtTotal colTotal\" data-value=\"5\" data-for=\"col5\" style=\"background-color: rgb(255, 251, 251);\">5</td><td class=\"pvtTotal colTotal\" data-value=\"13\" data-for=\"col6\" style=\"background-color: rgb(255, 234, 234);\">13</td><td class=\"pvtTotal colTotal\" data-value=\"88\" data-for=\"col7\" style=\"background-color: rgb(255, 74, 74);\">88</td><td class=\"pvtTotal colTotal\" data-value=\"31\" data-for=\"col8\" style=\"background-color: rgb(255, 195, 195);\">31</td><td class=\"pvtGrandTotal\" data-value=\"284\">284</td></tr></tbody>";
            HttpContext context = HttpContext.Current;

            string name = DateTime.Now.ToString();
            context.Response.Buffer = true;
            //输出的应用类型 
            context.Response.ContentType = "application/vnd.ms-excel";
            //设定编码方式，若输出的excel有乱码，可优先从编码方面解决
            context.Response.Charset = "utf-8";
            context.Response.ContentEncoding = System.Text.Encoding.UTF8;
            //filenames是自定义的文件名
            context.Response.AppendHeader("Content-Disposition", "attachment;filename=" + name + ".xls");
            //content是步骤1的html，注意是string类型
            context.Response.Write(tableHtml);
            context.Response.End();
            return context;
        }
    }
}